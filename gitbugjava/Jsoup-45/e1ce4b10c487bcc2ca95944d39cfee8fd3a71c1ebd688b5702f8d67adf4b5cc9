{
    "generation": "    void resetInsertionMode() {\n        boolean last = false;\n        for (int pos = stack.size() -1; pos >= 0; pos--) {\n            Element node = stack.get(pos);\n            if (pos == 0) {\n                last = true;\n                // Ensure contextElement is used if it exists, especially for fragment parsing.\n                if (contextElement != null) {\n                    node = contextElement;\n                }\n            }\n            \n            // The node might be null if contextElement is null and pos is 0.\n            // This shouldn't happen in typical scenarios but guard against NullPointerException.\n            if (node == null) { \n                 // Or handle appropriately, e.g., default to InBody or throw an error\n                 transition(HtmlTreeBuilderState.InBody); // Default or safe fallback\n                 break;\n            }\n\n            String name = node.nodeName();\n            if (\"select\".equals(name)) {\n                transition(HtmlTreeBuilderState.InSelect);\n                break; // frag\n            } else if ((\"td\".equals(name) || \"th\".equals(name)) && !last) { // ** FIX: Corrected condition to include \"th\" **\n                transition(HtmlTreeBuilderState.InCell);\n                break;\n            } else if (\"tr\".equals(name)) {\n                transition(HtmlTreeBuilderState.InRow);\n                break;\n            } else if (\"tbody\".equals(name) || \"thead\".equals(name) || \"tfoot\".equals(name)) {\n                transition(HtmlTreeBuilderState.InTableBody);\n                break;\n            } else if (\"caption\".equals(name)) {\n                transition(HtmlTreeBuilderState.InCaption);\n                break;\n            } else if (\"colgroup\".equals(name)) {\n                transition(HtmlTreeBuilderState.InColumnGroup);\n                break; // frag\n            } else if (\"table\".equals(name)) {\n                transition(HtmlTreeBuilderState.InTable);\n                break;\n            } else if (\"head\".equals(name)) {\n                 // Per spec: if last is false, transition to InHead. Otherwise fall through.\n                 // However, jsoup's behavior might rely on transitioning to InBody here.\n                 // Keeping original behavior unless further tests indicate otherwise.\n                transition(HtmlTreeBuilderState.InBody); // frag - Note: Spec says InHead if !last\n                break;\n            } else if (\"body\".equals(name)) {\n                transition(HtmlTreeBuilderState.InBody);\n                break;\n            } else if (\"frameset\".equals(name)) {\n                transition(HtmlTreeBuilderState.InFrameset);\n                break; // frag\n            } else if (\"html\".equals(name)) {\n                 // Per spec: depends on head element pointer. Simplified in jsoup.\n                 // Keeping original behavior.\n                transition(HtmlTreeBuilderState.BeforeHead); // frag\n                break;\n            } else if (last) {\n                // Reached the top of the stack or context element without matching specific container\n                transition(HtmlTreeBuilderState.InBody); // frag\n                break;\n            }\n        }\n        // If the loop completes without breaking (e.g., empty stack), what should happen?\n        // The current code does nothing, leaving the state unchanged. This might be intended\n        // or could be a potential issue if the stack is unexpectedly empty. However,\n        // given the loop condition `pos >= 0` and `stack.size() - 1`, it won't run for an empty stack.\n        // If stack has elements, `last=true` case ensures a break.\n    }",
    "exact_match": false,
    "ast_match": false,
    "compile": true,
    "test": true
}