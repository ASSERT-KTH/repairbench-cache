{
    "generation": "@Override\nprotected Object decode(\n        Channel channel, SocketAddress remoteAddress, Object msg) throws Exception {\n\n    ByteBuf buf = (ByteBuf) msg;\n\n    buf.readUnsignedShort(); // data length\n\n    String imei = String.format(\"%015d\", buf.readLong());\n    DeviceSession deviceSession = getDeviceSession(channel, remoteAddress, imei);\n    if (deviceSession == null) {\n        return null;\n    }\n\n    int type = buf.readUnsignedByte();\n\n    if (type == MSG_RECORDS || type == MSG_EXTENDED_RECORDS) {\n\n        List<Position> positions = new LinkedList<>();\n\n        buf.readUnsignedByte(); // records left\n        int count = buf.readUnsignedByte();\n\n        for (int i = 0; i < count; i++) {\n            Position position = new Position(getProtocolName());\n            position.setDeviceId(deviceSession.getDeviceId());\n\n            position.setTime(new Date(buf.readUnsignedInt() * 1000));\n            buf.readUnsignedByte(); // timestamp extension\n\n            if (type == MSG_EXTENDED_RECORDS) {\n                int recordExtension = buf.readUnsignedByte();\n                int mergeRecordCount = BitUtil.from(recordExtension, 4);\n                int currentRecord = BitUtil.to(recordExtension, 4);\n\n                if (currentRecord > 0 && currentRecord <= mergeRecordCount) {\n                    position = positions.remove(positions.size() - 1);\n                }\n            }\n\n            buf.readUnsignedByte(); // priority (reserved)\n\n            boolean isValid = true;\n\n            double longitude = buf.readInt() / 10000000.0;\n            if (longitude < -180 || longitude > 180) {\n                isValid = false;\n            }\n            position.setLongitude(longitude);\n\n            double latitude = buf.readInt() / 10000000.0;\n            if (latitude < -90 || latitude > 90) {\n                isValid = false;\n            }\n            position.setLatitude(latitude);\n\n            position.setAltitude(buf.readUnsignedShort() / 10.0);\n            position.setCourse(buf.readUnsignedShort() / 100.0);\n\n            position.set(Position.KEY_SATELLITES, buf.readUnsignedByte());\n\n            position.setSpeed(UnitsConverter.knotsFromKph(buf.readUnsignedShort()));\n\n            position.set(Position.KEY_HDOP, buf.readUnsignedByte() / 10.0);\n\n            if (type == MSG_EXTENDED_RECORDS) {\n                position.set(Position.KEY_EVENT, buf.readUnsignedShort());\n            } else {\n                position.set(Position.KEY_EVENT, buf.readUnsignedByte());\n            }\n\n            // Read 1 byte data\n            int valueCount = buf.readUnsignedByte();\n            for (int j = 0; j < valueCount; j++) {\n                int id = type == MSG_EXTENDED_RECORDS ? buf.readUnsignedShort() : buf.readUnsignedByte();\n                decodeParameter(position, id, buf, 1);\n            }\n\n            // Read 2 byte data\n            valueCount = buf.readUnsignedByte();\n            for (int j = 0; j < valueCount; j++) {\n                int id = type == MSG_EXTENDED_RECORDS ? buf.readUnsignedShort() : buf.readUnsignedByte();\n                decodeParameter(position, id, buf, 2);\n            }\n\n            // Read 4 byte data\n            valueCount = buf.readUnsignedByte();\n            for (int j = 0; j < valueCount; j++) {\n                int id = type == MSG_EXTENDED_RECORDS ? buf.readUnsignedShort() : buf.readUnsignedByte();\n                decodeParameter(position, id, buf, 4);\n            }\n\n            // Read 8 byte data\n            valueCount = buf.readUnsignedByte();\n            for (int j = 0; j < valueCount; j++) {\n                int id = type == MSG_EXTENDED_RECORDS ? buf.readUnsignedShort() : buf.readUnsignedByte();\n                decodeParameter(position, id, buf, 8);\n            }\n\n            position.setValid(isValid);\n            positions.add(position);\n        }\n\n        return positions;\n    }\n\n    return null;\n}",
    "exact_match": false,
    "ast_match": false,
    "compile": null,
    "test": false
}