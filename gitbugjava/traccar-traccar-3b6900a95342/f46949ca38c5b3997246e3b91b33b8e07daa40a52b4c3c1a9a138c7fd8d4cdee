{
    "generation": "@Override\nprotected Object decode(\n        Channel channel, SocketAddress remoteAddress, Object msg) throws Exception {\n\n    ByteBuf buf = (ByteBuf) msg;\n\n    buf.readUnsignedByte(); // header\n    int flags = buf.readUnsignedByte();\n    buf.readUnsignedShortLE(); // length\n    buf.readUnsignedShortLE(); // checksum\n    int index = buf.readUnsignedShortLE();\n\n    if (BitUtil.check(flags, 4)) {\n        sendResponse(channel, remoteAddress, index, buf.readUnsignedByte(), buf);\n    }\n\n    List<Position> positions = new LinkedList<>();\n    Set<Integer> keys = new HashSet<>();\n    boolean hasLocation = false;\n    Position position = new Position(getProtocolName());\n\n    DeviceSession deviceSession = null;\n\n    while (buf.isReadable()) {\n        int endIndex = buf.readUnsignedByte() + buf.readerIndex();\n        int key = buf.readUnsignedByte();\n\n        if (keys.contains(key)) {\n            if (!hasLocation) {\n                getLastLocation(position, null);\n            }\n            positions.add(position);\n            keys.clear();\n            hasLocation = false;\n            position = new Position(getProtocolName());\n        }\n        keys.add(key);\n\n        switch (key) {\n            // existing cases remain the same\n        }\n        buf.readerIndex(endIndex);\n    }\n\n    if (!hasLocation) {\n        getLastLocation(position, null);\n    }\n    positions.add(position);\n\n    if (deviceSession != null) {\n        for (Position p : positions) {\n            p.setDeviceId(deviceSession.getDeviceId());\n        }\n    } else {\n        return null;\n    }\n\n    return positions;\n}",
    "exact_match": false,
    "ast_match": false,
    "compile": null,
    "test": false
}