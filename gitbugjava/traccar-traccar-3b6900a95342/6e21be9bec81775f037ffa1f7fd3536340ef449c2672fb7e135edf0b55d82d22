{
    "generation": "    @Override\n    protected Object decode(\n            Channel channel, SocketAddress remoteAddress, Object msg) throws Exception {\n\n        ByteBuf buf = (ByteBuf) msg;\n\n        buf.readUnsignedByte(); // header\n\n        int flags = buf.readUnsignedByte();\n\n        buf.readUnsignedShortLE(); // length\n\n        buf.readUnsignedShortLE(); // checksum\n\n        int index = buf.readUnsignedShortLE();\n\n        if (BitUtil.check(flags, 4)) {\n\n            sendResponse(channel, remoteAddress, index,buf);\n\n        }\n\n        // Initialize the things \n\n        List<Position> positions = new LinkedList<>();\n\n        Set<Integer> keys = new HashSet<>();\n\n        boolean hasLocation = false;\n\n        Position position = new Position(getProtocolName());\n\n        DeviceSession deviceSession = null;\n\n        while (buf.isReadable()) {\n\n            int endIndex = buf.readUnsignedByte() + buf.readerIndex();\n\n            int key = buf.readUnsignedByte();\n\n            if (keys.contains(key)) {\n\n                if (!hasLocation) {\n\n                    getLastLocation(position, null);\n\n                }\n\n                positions.add(position);\n\n                keys.clear();\n\n                hasLocation = false;\n\n                position = new Position(getProtocolName());\n\n            }\n\n            keys.add(key);\n\n            switch (key) {\n\n                case 0x01:\n\n                    deviceSession = getDeviceSession(\n\n                            channel, remoteAddress, buf.readCharSequence(15, StandardCharsets.US_ASCII).toString());\n\n                    position.setDeviceId(deviceSession.getDeviceId());\n\n                    break;\n\n                case 0x02:\n\n                    long alarm = buf.readUnsignedIntLE();\n\n                    position.set(Position.KEY_ALARM, decodeAlarm(alarm));\n\n                    if (BitUtil.check(alarm, 31)) {\n\n                        position.set(\"bark\", true);\n\n                    }\n\n                    break;\n\n                case 0x14:\n\n                    ... \n\n                // other cases remain \n\n                default:\n\n                    break;\n\n            }\n\n            buf.readerIndex(endIndex);\n\n        } \n\n        if (!hasLocation) {\n\n            getLastLocation(position, null);\n\n        }\n\n        positions.add(position);\n\n        if (deviceSession != null) {\n\n            for (Position p : positions) {\n\n                p.setDeviceId(deviceSession.getDeviceId());\n\n            }\n\n        } else {\n\n            return null;\n\n        }\n\n        return positions;\n\n    }",
    "exact_match": false,
    "ast_match": false,
    "compile": null,
    "test": false
}