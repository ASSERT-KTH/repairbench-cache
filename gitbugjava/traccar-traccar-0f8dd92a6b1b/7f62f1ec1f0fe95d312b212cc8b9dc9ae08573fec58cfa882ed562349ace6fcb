{
    "generation": "private Object decodeExtended(Channel channel, SocketAddress remoteAddress, ByteBuf buf) {\n\n    DeviceSession deviceSession = getDeviceSession(channel, remoteAddress);\n    if (deviceSession == null) {\n        return null;\n    }\n\n    if (!deviceSession.contains(DeviceSession.KEY_TIMEZONE)) {\n        deviceSession.set(DeviceSession.KEY_TIMEZONE, getTimeZone(deviceSession.getDeviceId()));\n    }\n\n    Position position = new Position(getProtocolName());\n    position.setDeviceId(deviceSession.getDeviceId());\n\n    buf.readUnsignedShort(); // length\n    int type = buf.readUnsignedByte();\n\n    switch (type) {\n        case MSG_STRING_INFO:\n            buf.readUnsignedInt(); // server flag\n            String data;\n            if (buf.readUnsignedByte() == 1) {\n                data = buf.readSlice(buf.readableBytes() - 6).toString(StandardCharsets.US_ASCII);\n            } else {\n                data = buf.readSlice(buf.readableBytes() - 6).toString(StandardCharsets.UTF_16BE);\n            }\n\n            Parser parser = new Parser(PATTERN_LOCATION, data);\n\n            if (parser.matches()) {\n                position.setValid(true);\n                position.setLatitude(parser.nextCoordinate(Parser.CoordinateFormat.HEM_DEG));\n                position.setLongitude(parser.nextCoordinate(Parser.CoordinateFormat.HEM_DEG));\n                position.setCourse(parser.nextDouble());\n                position.setSpeed(parser.nextDouble());\n                position.setTime(parser.nextDateTime(Parser.DateTimeFormat.YMD_HMS));\n            } else {\n                getLastLocation(position, null);\n                position.set(Position.KEY_RESULT, data);\n            }\n\n            return position;\n\n        case MSG_INFO:\n            int subType = buf.readUnsignedByte();\n            getLastLocation(position, null);\n\n            switch (subType) {\n                case 0x00:\n                    position.set(Position.PREFIX_ADC + 1, buf.readUnsignedShort() * 0.01);\n                    return position;\n\n                case 0x05:\n                    if (buf.readableBytes() >= 6 + 1 + 6) {\n                        DateBuilder dateBuilder = new DateBuilder((TimeZone) deviceSession.get(DeviceSession.KEY_TIMEZONE))\n                                .setDate(buf.readUnsignedByte(), buf.readUnsignedByte(), buf.readUnsignedByte())\n                                .setTime(buf.readUnsignedByte(), buf.readUnsignedByte(), buf.readUnsignedByte());\n                        position.setDeviceTime(dateBuilder.getDate());\n                    }\n\n                    int flags = buf.readUnsignedByte();\n                    position.set(Position.KEY_DOOR, BitUtil.check(flags, 0));\n                    position.set(Position.PREFIX_IO + 1, BitUtil.check(flags, 2));\n                    return position;\n\n                case 0x0a:\n                    buf.skipBytes(8); // imei\n                    buf.skipBytes(8); // imsi\n                    position.set(Position.KEY_ICCID, ByteBufUtil.hexDump(buf.readSlice(10)).replaceAll(\"f\", \"\"));\n                    return position;\n\n                case 0x0d:\n                    if (buf.readableBytes() >= 10 && buf.getByte(buf.readerIndex()) != '!') {\n                        buf.skipBytes(6);\n                    }\n\n                    Parser fuelParser = new Parser(PATTERN_FUEL, buf.toString(\n                            buf.readerIndex(), buf.readableBytes() - 4 - 2, StandardCharsets.US_ASCII));\n                    if (!fuelParser.matches()) {\n                        return null;\n                    }\n\n                    position.set(Position.PREFIX_TEMP + 1, fuelParser.nextDouble(0));\n                    position.set(Position.KEY_FUEL_LEVEL, fuelParser.nextDouble(0));\n                    return position;\n\n                default:\n                    break;\n            }\n            break;\n\n        case MSG_X1_PHOTO_DATA:\n            int pictureId = buf.readInt();\n            ByteBuf photo = photos.get(pictureId);\n\n            buf.readUnsignedInt(); // offset\n            buf.readBytes(photo, buf.readUnsignedShort());\n\n            if (photo.writableBytes() > 0) {\n                sendPhotoRequest(channel, pictureId);\n            } else {\n                position.set(Position.KEY_IMAGE, writeMediaFile(deviceSession.getUniqueId(), photo, \"jpg\"));\n                photos.remove(pictureId).release();\n            }\n            return position;\n\n        case MSG_AZ735_GPS:\n        case MSG_AZ735_ALARM:\n            if (!decodeGps(position, buf, true, deviceSession.get(DeviceSession.KEY_TIMEZONE))) {\n                getLastLocation(position, position.getDeviceTime());\n            }\n\n            if (decodeLbs(position, buf, type, true)) {\n                position.set(Position.KEY_RSSI, buf.readUnsignedByte());\n            }\n            buf.skipBytes(buf.readUnsignedByte()); // additional cell towers\n            buf.skipBytes(buf.readUnsignedByte()); // wifi access point\n\n            int status = buf.readUnsignedByte();\n            position.set(Position.KEY_STATUS, status);\n\n            if (type == MSG_AZ735_ALARM) {\n                setAlarmAttributes(position, status);\n            }\n\n            buf.skipBytes(buf.readUnsignedByte()); // reserved extension\n\n            sendResponse(channel, true, type, buf.getShort(buf.writerIndex() - 6), null);\n            return position;\n\n        case MSG_OBD:\n            position = decodeObd(deviceSession, position, buf);\n            return position;\n\n        case MSG_MULTIMEDIA:\n            position = decodeMultimedia(deviceSession, position, buf);\n            return position;\n\n        case MSG_SERIAL:\n            position = decodeSerial(deviceSession, position, buf);\n            return position;\n\n        default:\n            return null;\n    }\n\n    return null;\n}\n\nprivate void setAlarmAttributes(Position position, int status) {\n    switch (status) {\n        case 0xA0:\n            position.set(Position.KEY_ARMED, true);\n            break;\n        case 0xA1:\n            position.set(Position.KEY_ARMED, false);\n            break;\n        case 0xA2:\n        case 0xA3:\n            position.set(Position.KEY_ALARM, Position.ALARM_LOW_BATTERY);\n            break;\n        case 0xA4:\n            position.set(Position.KEY_ALARM, Position.ALARM_GENERAL);\n            break;\n        case 0xA5:\n            position.set(Position.KEY_ALARM, Position.ALARM_DOOR);\n            break;\n        default:\n            break;\n    }\n}",
    "exact_match": false,
    "ast_match": false,
    "compile": null,
    "test": false
}