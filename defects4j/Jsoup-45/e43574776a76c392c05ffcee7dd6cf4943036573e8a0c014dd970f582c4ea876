{
    "generation": "    void resetInsertionMode() {\n        boolean last = false;\n        for (int pos = stack.size() -1; pos >= 0; pos--) {\n            Element node = stack.get(pos);\n            if (pos == 0) {\n                last = true;\n                // NOTE: The original code assigned contextElement to node here.\n                // It might be relevant for fragment parsing. Let's keep it.\n                // However, the 'name' calculation below needs to happen *after* this assignment\n                // for the last element check to use the contextElement's name.\n                node = contextElement;\n            }\n            // Calculate name *after* potential node reassignment when pos == 0\n            String name = node.nodeName();\n\n            if (\"select\".equals(name)) {\n                transition(HtmlTreeBuilderState.InSelect);\n                break; // frag\n            // Fixed: Added \"th\".equals(name) check. The original code had a redundant \"td\" check.\n            // Also ensure the !last check applies to both td and th as per HTML5 spec \u00a7 8.2.3.1 step 4.\n            } else if ((\"td\".equals(name) || \"th\".equals(name)) && !last) {\n                transition(HtmlTreeBuilderState.InCell);\n                break;\n            } else if (\"tr\".equals(name)) {\n                transition(HtmlTreeBuilderState.InRow);\n                break;\n            } else if (\"tbody\".equals(name) || \"thead\".equals(name) || \"tfoot\".equals(name)) {\n                transition(HtmlTreeBuilderState.InTableBody);\n                break;\n            } else if (\"caption\".equals(name)) {\n                transition(HtmlTreeBuilderState.InCaption);\n                break;\n            } else if (\"colgroup\".equals(name)) {\n                transition(HtmlTreeBuilderState.InColumnGroup);\n                break; // frag\n            } else if (\"table\".equals(name)) {\n                transition(HtmlTreeBuilderState.InTable);\n                break;\n            } else if (\"head\".equals(name)) {\n                // Keep original behaviour (transition to InBody), might be fragment specific\n                // Spec says InHead if !last, but this code differs.\n                transition(HtmlTreeBuilderState.InBody);\n                break; // frag\n            } else if (\"body\".equals(name)) {\n                transition(HtmlTreeBuilderState.InBody);\n                break;\n            } else if (\"frameset\".equals(name)) {\n                transition(HtmlTreeBuilderState.InFrameset);\n                break; // frag\n            } else if (\"html\".equals(name)) {\n                // Keep original behaviour (transition to BeforeHead), might be fragment specific\n                // Spec dependence on headElement pointer.\n                transition(HtmlTreeBuilderState.BeforeHead);\n                break; // frag\n            } else if (last) {\n                // This is the final fallback (Spec step 14)\n                transition(HtmlTreeBuilderState.InBody);\n                break; // frag\n            }\n        }\n    }",
    "exact_match": false,
    "ast_match": false,
    "compile": true,
    "test": true
}